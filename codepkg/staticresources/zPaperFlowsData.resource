{"flows":[{"id":"48bcffa1.d58d","type":"tab","label":"DTPC Inbound","disabled":false,"showlanes":false,"swimlanes":[],"info":""},{"id":"ea60f4f.32b9d08","type":"tab","label":"DTPC Outbound Delivery Complete","disabled":false,"showlanes":false,"swimlanes":[],"info":""},{"id":"e176da1e.dbf8c8","type":"zFax","z":"48bcffa1.d58d","name":"New Incoming Fax","link":"","format":"text","template":"","x":130,"y":60,"wires":[["8aa16047.4b80e"]]},{"id":"8aa16047.4b80e","type":"zAction","z":"48bcffa1.d58d","name":"zStack Library","func":"//global variables\n\n\nzData.patEnrollQueueId = \"\"; \n\nzData.programName = \"\";\n\n//CRN170324 TODO doc.clone() done right;\nzData.clone=function(doc) {\n   var doc0=[];\n   for (var i in doc) doc0[i]=doc[i];\n   return doc0;\n}\n\nzData.setbrandprogram = function(doc) {\n    alert(\"+++ STARTING zData.setbrandprogram +++\");\n    alert(\"@@@ doc.deliveredTo = \" + doc.deliveredTo);\n    if (doc.deliveredTo.indexOf(\"6782356995\")>-1) { //ERS70421 indexOf is safer #36411\n        zData.programName = \"zCharta\";\n        zData.patEnrollQueueId = \"00Gf4000000VnBEEA0\";\n    } else if (doc.deliveredTo.indexOf(\"6787270123\")>-1) {\n        zData.programName = \"zPapyrus\";\n        zData.patEnrollQueueId = \"00Gf4000000VnBJEA0\";\n    } \n    alert(\"+++ ENDING zData.setbrandprogram +++\");\n    alert(\"@@@ zData.programName = \" + zData.programName);\n  \n}\n\n/* This function needs to be added to every rule to help assure that rules do not get accidentally triggered */\n/* Add this functionality to the rules engine itself? */\nzData.clearTriggerCondition=function(doc,triggerField) {  //ERS170512 moved to library\n  var arrOfPairs = [];\n  arrOfPairs.push(triggerField, \"\");\n  updateDB(doc,arrOfPairs);\n}\n\nzData.initializeStack=function(doc,stackFolder,stackId) { //ERS170512 moved to library\n  var arrOfPairs = [];\n  var today = new Date();\n  var curMonth = today.getMonth() + 1;\n  var finalRootFolder = zData.programName+\"-Archive\"; //bates of the Archive folder\n  var yyyyMMFolderName = today.getFullYear() + (curMonth > 9 ? curMonth+\"\" : \"0\"+curMonth);\n  var yyyyMMFolder = finalRootFolder + \"-\" + yyyyMMFolderName;\n  alert(\"@@@ stackFolder is - \" + stackFolder);\n  alert(\"@@@ finalRootFolder is - \" + finalRootFolder);\n  alert(\"@@@ yyMMFolder is - \" + yyyyMMFolder);\n  alert(\"@@@ creating new stack destination folder with name - \" + stackFolder);\n  /* Refresh the current folder */\n  reloadById(doc, X(doc,\"X_curFolder\"));\n  /* same value for BATES and label */\n  /* The folder structure will look like this: /201608/3CX3CX/123456789-STACK */\n  createFolder(doc, finalRootFolder, yyyyMMFolder, yyyyMMFolderName);\n  createFolder(doc, yyyyMMFolder, stackFolder, stackFolder);\n  alert(\"@@@@ Moving the stack document into the stack folder: \" + stackFolder);\n  moveDocument(doc,\"\",stackFolder);\n  arrOfPairs.push(\"X_indexInitialized\", \"true\");\n  arrOfPairs.push(\"X_stack\", stackId);\n  arrOfPairs.push(\"db-BATES\", doc.kbData.groupID.substring(1) + \"-\" + stackId + \"-STACK\");\n  /* Stack Labelling Change */\n  var dtStamp = getCurDateAndTime(doc, false);\n  /* arrOfPairs.push(\"db-label\",\"Stack - \" + dtStamp); */\n  updateDB(doc,arrOfPairs);\n}\n\nzData.countPages=function(doc,pageRange) {  //ERS170512 moved to library\n  var pages = pageRange.split(\",\");\n  if (!pages) pages=[pageRange];\n  return pages.length + \"\";\n}\n\n/* END */","active":true,"button":"","outputs":1,"noerr":0,"x":340,"y":60,"wires":[["ff1d6129.96c01"]]},{"id":"ff1d6129.96c01","type":"zAction","z":"48bcffa1.d58d","name":"Set all required Stack attributes","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":310,"y":140,"wires":[["bd054b91.b5dae8","1117daa7.0e8a95"]]},{"id":"bd054b91.b5dae8","type":"zStack","z":"48bcffa1.d58d","name":"New zStack Created","link":"","format":"text","template":"in related list will have the document record\nwe create files","x":640,"y":80,"wires":[[]]},{"id":"1117daa7.0e8a95","type":"zAction","z":"48bcffa1.d58d","name":"Document Record created","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":230,"y":240,"wires":[["431853de.d2116c","6c5ea350.3b92bc"]]},{"id":"431853de.d2116c","type":"soql","z":"48bcffa1.d58d","name":"Document Record available in Patient Connect","query":"","connection":"","fetchAll":false,"x":280,"y":340,"wires":[["5704b40a.bf240c","84f69c16.13fb4","c0b0bd5d.ffd11"]]},{"id":"5704b40a.bf240c","type":"zAction","z":"48bcffa1.d58d","name":"Ability to split pages","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":700,"y":180,"wires":[["5cb23a32.8bc094"]]},{"id":"84f69c16.13fb4","type":"zAction","z":"48bcffa1.d58d","name":"Ability to Mark-up pages","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":710,"y":220,"wires":[["e556925.a0eb47"]]},{"id":"c0b0bd5d.ffd11","type":"zAction","z":"48bcffa1.d58d","name":"Ability to Forward pages","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":710,"y":260,"wires":[["c5d8572e.b88238"]]},{"id":"5cb23a32.8bc094","type":"soql","z":"48bcffa1.d58d","name":"Multiple document records are created","query":"","connection":"","fetchAll":false,"x":1050,"y":340,"wires":[[]]},{"id":"e556925.a0eb47","type":"soql","z":"48bcffa1.d58d","name":"Document is marked up and available for sending","query":"","connection":"","fetchAll":false,"x":1090,"y":380,"wires":[[]]},{"id":"c5d8572e.b88238","type":"soql","z":"48bcffa1.d58d","name":"Document can be forwarded","query":"","connection":"","fetchAll":false,"x":1020,"y":420,"wires":[[]]},{"id":"6c5ea350.3b92bc","type":"soql","z":"48bcffa1.d58d","name":"CASE from barcoded outbound template","query":"","connection":"","fetchAll":false,"x":330,"y":560,"wires":[[]]},{"id":"4b971453.937b3c","type":"soql","z":"ea60f4f.32b9d08","name":"Document Record available in Patient Connect","query":"","connection":"","fetchAll":false,"x":220,"y":200,"wires":[["7a07d87e.f3bbf8"]]},{"id":"7a07d87e.f3bbf8","type":"soql","z":"ea60f4f.32b9d08","name":"Case Record","query":"","connection":"","fetchAll":false,"x":390,"y":380,"wires":[["e25bf9a7.b3feb8"]]},{"id":"e25bf9a7.b3feb8","type":"soql","z":"ea60f4f.32b9d08","name":"eLetter","query":"","connection":"","fetchAll":false,"x":600,"y":200,"wires":[["545a2d98.b82674","36902d01.ecb422"]]},{"id":"545a2d98.b82674","type":"e-mail","z":"ea60f4f.32b9d08","server":"smtp.gmail.com","port":"465","secure":true,"name":"","dname":"","x":790,"y":260,"wires":[]},{"id":"36902d01.ecb422","type":"zFax","z":"ea60f4f.32b9d08","name":"","link":"","format":"text","template":"","x":830,"y":60,"wires":[[]]},{"id":"1adae75f.a7aa99","type":"zComment","z":"48bcffa1.d58d","name":"Create record","link":"","info":"Create zStack Record as well as PC document record\nbased on QR code fields will get updated","x":270,"y":200,"wires":[]},{"id":"377b7913.004906","type":"zComment","z":"48bcffa1.d58d","name":"Auto Forward","link":"","info":"As soon as Fax recives zPaper reads the QR code\nand update the document type on record\nBased on the Document type fax forwards to Pharmacy\nAs soon as we forward the fax to pharmacy we \ncreate the activity history as failed or deliverd","x":600,"y":40,"wires":[]}],"rev":"0"}