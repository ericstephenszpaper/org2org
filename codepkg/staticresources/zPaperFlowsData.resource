{"flows":[{"id":"17887126.a83fff","type":"tab","label":"Phase 1 Incoming","disabled":false,"showlanes":true,"swimlanes":[{"colour":"#0077ff40","title":"fax to zstack","height":300},{"colour":"#ff000040","title":"salesforce","height":300},{"colour":"#00770040","title":"operators","height":300}],"info":""},{"id":"42d93f5e.be1e3","type":"tab","label":"Phase 1 Outgoing","disabled":false,"showlanes":true,"swimlanes":[{"colour":"#ffff0040","title":"Program Member","height":300},{"colour":"#ff000040","title":"Activity / Attachment","height":300}],"info":""},{"id":"c095cb5e.abe898","type":"zFax","z":"17887126.a83fff","name":"678-948-9696","link":"","format":"text","template":"","x":160,"y":80,"wires":[["314184e4.e7eb0c"]]},{"id":"83d8f877.49e288","type":"zAction","z":"17887126.a83fff","name":"zStack Library","func":"//global variables\n\n\nzData.patEnrollQueueId = \"\"; \n\nzData.programName = \"\";\n\n//CRN170324 TODO doc.clone() done right;\nzData.clone=function(doc) {\n   var doc0=[];\n   for (var i in doc) doc0[i]=doc[i];\n   return doc0;\n}\n\nzData.setbrandprogram = function(doc) {\n    alert(\"+++ STARTING zData.setbrandprogram +++\");\n    alert(\"@@@ doc.deliveredTo = \" + doc.deliveredTo);\n    if (doc.deliveredTo.indexOf(\"6782356995\")>-1) { //ERS70421 indexOf is safer #36411\n        zData.programName = \"zCharta\";\n        zData.patEnrollQueueId = \"00Gf4000000VnBEEA0\";\n    } else if (doc.deliveredTo.indexOf(\"6787270123\")>-1) {\n        zData.programName = \"zPapyrus\";\n        zData.patEnrollQueueId = \"00Gf4000000VnBJEA0\";\n    } \n    alert(\"+++ ENDING zData.setbrandprogram +++\");\n    alert(\"@@@ zData.programName = \" + zData.programName);\n  \n}\n\n/* This function needs to be added to every rule to help assure that rules do not get accidentally triggered */\n/* Add this functionality to the rules engine itself? */\nzData.clearTriggerCondition=function(doc,triggerField) {  //ERS170512 moved to library\n  var arrOfPairs = [];\n  arrOfPairs.push(triggerField, \"\");\n  updateDB(doc,arrOfPairs);\n}\n\nzData.initializeStack=function(doc,stackFolder,stackId) { //ERS170512 moved to library\n  var arrOfPairs = [];\n  var today = new Date();\n  var curMonth = today.getMonth() + 1;\n  var finalRootFolder = zData.programName+\"-Archive\"; //bates of the Archive folder\n  var yyyyMMFolderName = today.getFullYear() + (curMonth > 9 ? curMonth+\"\" : \"0\"+curMonth);\n  var yyyyMMFolder = finalRootFolder + \"-\" + yyyyMMFolderName;\n  alert(\"@@@ stackFolder is - \" + stackFolder);\n  alert(\"@@@ finalRootFolder is - \" + finalRootFolder);\n  alert(\"@@@ yyMMFolder is - \" + yyyyMMFolder);\n  alert(\"@@@ creating new stack destination folder with name - \" + stackFolder);\n  /* Refresh the current folder */\n  reloadById(doc, X(doc,\"X_curFolder\"));\n  /* same value for BATES and label */\n  /* The folder structure will look like this: /201608/3CX3CX/123456789-STACK */\n  createFolder(doc, finalRootFolder, yyyyMMFolder, yyyyMMFolderName);\n  createFolder(doc, yyyyMMFolder, stackFolder, stackFolder);\n  alert(\"@@@@ Moving the stack document into the stack folder: \" + stackFolder);\n  moveDocument(doc,\"\",stackFolder);\n  arrOfPairs.push(\"X_indexInitialized\", \"true\");\n  arrOfPairs.push(\"X_stack\", stackId);\n  arrOfPairs.push(\"db-BATES\", doc.kbData.groupID.substring(1) + \"-\" + stackId + \"-STACK\");\n  /* Stack Labelling Change */\n  var dtStamp = getCurDateAndTime(doc, false);\n  /* arrOfPairs.push(\"db-label\",\"Stack - \" + dtStamp); */\n  updateDB(doc,arrOfPairs);\n}\n\nzData.countPages=function(doc,pageRange) {  //ERS170512 moved to library\n  var pages = pageRange.split(\",\");\n  if (!pages) pages=[pageRange];\n  return pages.length + \"\";\n}\n\n/* END */","active":true,"button":"","outputs":1,"noerr":0,"x":651,"y":78,"wires":[[]]},{"id":"314184e4.e7eb0c","type":"zAction","z":"17887126.a83fff","name":"Create Stack from Fax","func":"//ERS170804 docType by OCR\nvar keywords=[\"REG:Regulation~\",\"REF:REFERRAL\",\"REF:Referral\",\"PAPP:Patient Assistance\",\"PAUTH:Prior~ Authorization~\",\"ENRL:Enrollment~\",\"FAX:\"];\n\n//ERS171012 keywords for demo\nkeywords=[\"ENRL:Enrollment~\",\"CON:Consent~\",\"CON:consent~\",\"PAPP:Patient Assistance\",\"PAUTH:Prior~ Authorization~\",\"REG:Regulation~\",\"REF:REFERRAL\",\"REF:Referral\",\"FAX:\"];\n\nzData.docTypeOCR=zData.docTyper(doc,keywords); //ERS171012 TODO missing for MP\n//zData.docTypeOCR=zData.docTyper(doc,{\"REG\":\"Regulation~\",\"PAPP\":\"Patient~ Assistance~\",\"PAUTH\":\"Prior~ Authorization~\",\"ENRL\":\"Enrollment~\",\"FAX\":\"\"});\nalert(\"docType was \"+doc.docType+\" now \"+ zData.docTypeOCR);\nvar zType=doc.X(\"X_docType\");\nif (doc.docType != zData.docTypeOCR) {\n    var arrOfPairs0 = [];\n    arrOfPairs0.push(\"X_docTypeOCR\",zData.docTypeOCR);\n\tarrOfPairs0.push(\"X_docType\",zData.docTypeOCR);\n    zType=zData.docTypeOCR; //ERS170330 saved below into SF faxType__c field\n    updateDB(doc, arrOfPairs0);\n}\n\nzData.setbrandprogram(doc); //who and where\n\nvar formatNow = getCurDateAndTime(doc);\nvar arrOfPairs = [];\nvar zp=\"ZPAPER__\"; //ERS170626 now in the package\nvar zStack=zp+\"zStack__c\"; //\"Stack__c\"\narrOfPairs.push(zp+\"faxType__c\", zType);\narrOfPairs.push(zp+\"Status__c\", \"New Stack\");\narrOfPairs.push(zp+\"Channel__c\", \"Fax\");\narrOfPairs.push(zp+\"latestFax__c\", formatNow);\narrOfPairs.push(zp+\"receivedId__c\", doc.dbID);\narrOfPairs.push(zp+\"newFax__c\", \"true\");\narrOfPairs.push(zp+\"Pages__c\", X(doc, \"X_pages\"));\nif (zData.patEnrollQueueId) arrOfPairs.push(\"OwnerId\",zData.patEnrollQueueId);\nif (zData.programName === \"zCharta\") {\n\tarrOfPairs.push(zp+\"Priority__c\", \"Urgent\");\n}\nelse {\n\tarrOfPairs.push(zp+\"Priority__c\", \"Medium\");\n}\narrOfPairs.push(zp+\"Program_Name__c\", zData.programName);\narrOfPairs.push(zp+\"sentFaxTo__c\",doc.deliveredTo); //ERS170628 caller id\narrOfPairs.push(zp+\"From__c\",doc.deliveredFrom);\narrOfPairs.push(zp+\"Stage__c\", \"Received\"); //ERS170731 #40593\n\nvar sfId = createAndAttach(doc, zStack, \"New Stack received on \" + formatNow, arrOfPairs);\nalert(\"#### Stack Received. Attached to: \" + sfId);\narrOfPairs = [];\narrOfPairs.push(\"db-label\", \"New Stack received on \" + formatNow);\narrOfPairs.push(\"db-BATES\", sfId + \"-STACK\");\narrOfPairs.push(\"X_sfStackId\",sfId); //ERS170727 #40447\nif (1===1) { //ERS180103 set as Received #41155\n    var ba=\"Received\";\n    var now0 = getCurDateAndTime(doc,false,true);\n    arrOfPairs.push(\"X_reviewedStatus\",ba);\n    arrOfPairs.push(\"X_reviews\",X(doc,\"X_reviews\")+ba+\" by agent at \"+now0+\"<br/>\"); //ERS170909 #40592\n}\nupdateDB(doc, arrOfPairs);\n /* END */","active":true,"button":"","outputs":1,"noerr":0,"x":418,"y":136,"wires":[["83d8f877.49e288","f805c48.d477f38"]]},{"id":"907fea46.3d1f38","type":"zAction","z":"17887126.a83fff","name":"Program Name queue set by fax #","func":"\nreturn msg;","active":true,"button":"","outputs":1,"continue":false,"noerr":0,"x":249,"y":386,"wires":[["afc6424a.be608","42087496.90081c"]]},{"id":"bc0e5c3a.a4b5e","type":"function","z":"17887126.a83fff","name":"User triages zStacks in queue","func":"\nreturn msg;","outputs":1,"noerr":0,"x":827,"y":598,"wires":[["295d72bf.14154e"]]},{"id":"f805c48.d477f38","type":"zAction","z":"17887126.a83fff","name":"Set all required Stack attributes","func":"\nreturn msg;","active":true,"button":"","outputs":1,"noerr":0,"x":576,"y":297,"wires":[["907fea46.3d1f38"]]},{"id":"59e39da7.626a44","type":"zAction","z":"17887126.a83fff","name":"Manual Attach Panel","func":"","active":false,"button":"","outputs":1,"continue":false,"noerr":0,"x":246,"y":801,"wires":[["1d419384.2242cc","8450cd7f.2a2e1"]]},{"id":"1d419384.2242cc","type":"soql","z":"17887126.a83fff","name":"Existing Program Member MVN lookup (optional)","query":"","connection":"","fetchAll":false,"x":603,"y":726,"wires":[["5ccee631.7cc598"]]},{"id":"5ccee631.7cc598","type":"function","z":"17887126.a83fff","name":"removes zStack record from queue to Stack Complete list view","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1024,"y":811,"wires":[[]]},{"id":"c58a5908.448e78","type":"zFax","z":"17887126.a83fff","name":"678-948-9708","link":"","format":"text","template":"","x":160,"y":200,"wires":[["314184e4.e7eb0c"]]},{"id":"8450cd7f.2a2e1","type":"soql","z":"17887126.a83fff","name":"Create New Program Member","query":"","connection":"","fetchAll":false,"x":552,"y":848,"wires":[["5ccee631.7cc598"]]},{"id":"cfdcbac7.65f668","type":"zAction","z":"42d93f5e.be1e3","name":"From Program Member Send a Doc Button","func":"\nreturn msg;","active":true,"button":"","outputs":1,"continue":false,"noerr":0,"x":268,"y":62,"wires":[["ad733cd7.7d952"]]},{"id":"ad733cd7.7d952","type":"zAction","z":"42d93f5e.be1e3","name":"Manually attach doc from drive","func":"\nreturn msg;","active":true,"button":"","outputs":1,"continue":false,"noerr":0,"x":640,"y":228,"wires":[["7a07aede.7aad"]]},{"id":"6662f946.1ee138","type":"zComment","z":"42d93f5e.be1e3","name":"Took button off layout for profile","link":"","info":"","x":470,"y":143,"wires":[]},{"id":"7a07aede.7aad","type":"zAction","z":"42d93f5e.be1e3","name":"After delivered task under History","func":"\nreturn msg;","active":true,"button":"","outputs":1,"continue":false,"noerr":0,"x":321,"y":380,"wires":[[]]},{"id":"295d72bf.14154e","type":"function","z":"17887126.a83fff","name":"Select Triage Link","func":"\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":660,"wires":[["59e39da7.626a44"]]},{"id":"afc6424a.be608","type":"soql","z":"17887126.a83fff","name":"Orphan Rare Disease","query":"","connection":"","fetchAll":false,"x":560,"y":380,"wires":[["bc0e5c3a.a4b5e"]]},{"id":"42087496.90081c","type":"soql","z":"17887126.a83fff","name":"Rheumatology","query":"","connection":"","fetchAll":false,"x":480,"y":460,"wires":[["bc0e5c3a.a4b5e"]]}],"rev":0}